# リーグ作成フォーム - 画面仕様

**Issue**: #47
**URL**: https://github.com/aki05162525/kojiro-mahjong-app/issues/47

## 画面構成

### 1. リーグ一覧ページ (`/leagues`)

#### 追加要素
- **リーグ作成ボタン**
  - 位置: ページ右上（既存のページヘッダー内）
  - ラベル: "リーグを作成"
  - スタイル: Primary ボタン
  - アクション: クリックでダイアログを表示

### 2. リーグ作成ダイアログ

#### レイアウト
- **モーダルダイアログ** (shadcn/ui `Dialog` コンポーネント使用)
- **幅**: 最大 600px
- **位置**: 画面中央
- **高さ**: コンテンツに応じて可変（最大画面高の 90%）
- **スクロール**: プレイヤーリストが長い場合はダイアログ内でスクロール

#### 構成要素

**ヘッダー**
- タイトル: "新しいリーグを作成"
- 閉じるボタン (×)

**フォーム**
1. **リーグ名** (必須)
   - ラベル: "リーグ名"
   - 入力形式: テキストフィールド
   - プレースホルダー: "例: 2025年春季リーグ"
   - バリデーション:
     - 必須入力
     - 1文字以上20文字以内
   - エラーメッセージ:
     - 未入力: "リーグ名を入力してください"
     - 文字数超過: "リーグ名は20文字以内で入力してください"

2. **説明** (任意)
   - ラベル: "説明"
   - 入力形式: テキストエリア (3行程度)
   - プレースホルダー: "リーグの説明を入力してください (任意)"
   - バリデーション: なし

3. **プレイヤー人数選択** (必須)
   - ラベル: "プレイヤー人数"
   - 入力形式: ラジオボタン
   - 選択肢:
     - 8人
     - 16人
   - デフォルト: 8人

4. **プレイヤー登録** (必須)
   - ラベル: "プレイヤー新規作成"
   - 構成:
     - テキストフィールド: プレイヤー名入力欄
     - プレースホルダー: "名前を入力"
     - 「作成」ボタン（入力欄の右側）
   - バリデーション:
     - プレイヤー名: 1文字以上20文字以内
     - 入力欄が空の場合は「作成」ボタンを disabled
     - 同じリーグ内で重複する名前は不可
   - エラーメッセージ:
     - 重複時: "同じ名前のプレイヤーが既に存在します" (入力欄下に赤文字表示)
     - 文字数超過: "プレイヤー名は20文字以内で入力してください"
   - 挙動:
     - 「作成」ボタンクリックで、下記プレイヤー一覧の末尾に追加
     - 追加後、入力欄を自動クリア
     - 最大人数（8人 or 16人）に達したら入力欄と「作成」ボタンを非表示

5. **プレイヤー一覧** (必須: 8人 or 16人)
   - 表示形式: リスト（スクロール可能）
   - 各アイテム:
     - プレイヤー名
     - 削除ボタン (×) - クリックでリストから削除
   - 表示:
     - 現在の登録数 / 必要人数 (例: "3 / 8 人")
   - バリデーション:
     - 選択した人数（8人 or 16人）と一致しない場合、フォーム送信不可

**フッター**
- **キャンセルボタン**
  - ラベル: "キャンセル"
  - スタイル: Secondary/Outline
  - アクション: ダイアログを閉じる

- **作成ボタン**
  - ラベル: "作成"
  - スタイル: Primary
  - 状態:
    - ローディング中: disabled + スピナー表示
    - バリデーションエラー時: disabled
    - プレイヤー数が不足/超過: disabled
  - アクション: リーグとプレイヤーを一括作成 API を呼び出し

## 動作仕様

### 正常フロー
1. ユーザーが「リーグを作成」ボタンをクリック
2. ダイアログが表示される
3. リーグ名、説明を入力
4. プレイヤー人数（8人 or 16人）を選択
5. プレイヤーを追加:
   - 名前を入力欄に入力
   - 「作成」ボタンをクリック
   - プレイヤー一覧に追加される
   - 入力欄が自動クリア
   - 上記を繰り返して必要人数分登録
6. 全項目入力完了後、「作成」ボタンをクリック
7. ローディング表示
8. 作成成功
9. ダイアログが閉じる
10. 成功トースト表示: "リーグを作成しました"
11. リーグ一覧が自動更新され、新しいリーグが表示される

### エラーフロー
1. **バリデーションエラー**
   - フィールド下に赤文字でエラーメッセージ表示
   - 「作成」ボタンは disabled のまま

2. **プレイヤー名重複エラー**
   - プレイヤー追加時、既存の名前と重複した場合
   - 入力欄下に赤文字で "同じ名前のプレイヤーが既に存在します" を表示
   - プレイヤー一覧には追加されない
   - ユーザーは別の名前を入力可能

3. **プレイヤー人数不足**
   - 選択した人数（8人 or 16人）に達していない
   - 「作成」ボタンは disabled
   - プレイヤー一覧の上部に "3 / 8 人" のように進捗表示

4. **プレイヤー人数選択変更時**
   - 例: 8人で5人登録後、16人に変更
     - 既存の5人はそのまま維持
     - 残り11人を追加可能
   - 例: 16人で10人登録後、8人に変更
     - 既存の10人はそのまま維持（超過状態）
     - 2人削除するまで「作成」ボタンは disabled

5. **API エラー**
   - ダイアログは開いたまま
   - エラートースト表示: "リーグの作成に失敗しました"
   - ローディング状態解除
   - ユーザーは再試行可能

6. **キャンセル**
   - ダイアログが閉じる
   - 入力内容は破棄

## 技術要件

### 使用コンポーネント (shadcn/ui)
- `Dialog`
- `Form` (React Hook Form)
- `Input`
- `Textarea`
- `RadioGroup` (プレイヤー人数選択)
- `Button`
- `ScrollArea` (プレイヤー一覧)
- Toast (成功/エラー通知)

### バリデーション
- ライブラリ: `zod`
- スキーマ: `src/schemas/leagues.ts` の `createLeagueSchema` を使用
  - リーグ名: 1-20文字
  - プレイヤー: 8人 or 16人の配列
  - プレイヤー名: 各1-20文字、リーグ内で一意

### API 統合
- React Query の mutation を使用
- エンドポイント: `POST /api/leagues`
- リクエストボディ:
  ```json
  {
    "name": "2025年春季リーグ",
    "description": "説明（任意）",
    "players": [
      { "name": "プレイヤー1" },
      { "name": "プレイヤー2" },
      ...
    ]
  }
  ```
- 成功時に `queryClient.invalidateQueries(['leagues'])` でキャッシュ更新

### 状態管理
- **フォーム状態**: React Hook Form
  - `useForm` でフォーム全体を管理
  - `useFieldArray` でプレイヤーリストを管理
- **ダイアログ開閉**: ローカル state (`useState`)
- **ローディング状態**: mutation の `isPending`
- **プレイヤー入力欄**: ローカル state (`useState<string>`) - フォームとは別管理

### フロントエンド実装の注意点

#### React Hook Form の構成
```tsx
const form = useForm({
  resolver: zodResolver(createLeagueSchema),
  defaultValues: {
    name: '',
    description: '',
    players: []
  }
})

const { fields, append, remove } = useFieldArray({
  control: form.control,
  name: 'players'
})
```

#### プレイヤー追加の実装
- プレイヤー名入力欄は `useFieldArray` とは別の `useState` で管理
- 「作成」ボタンクリック時:
  1. 重複チェック（`fields` 配列内で同名チェック）
  2. `append({ name: playerNameInput })` で追加
  3. 入力欄を `setPlayerNameInput('')` でクリア
- 削除: `remove(index)` を使用

#### バリデーション
- プレイヤー数（8人 or 16人）のチェックは Zod スキーマで実施
- 重複チェックはフロントエンドで実施（追加時に `fields.some()` で確認）
- `formState.isValid` で「作成」ボタンの disabled 制御

#### その他
- プレイヤー数カウント表示: `fields.length / 8` (or 16)
- 入力欄と「作成」ボタンの表示制御: `fields.length >= maxPlayers` で非表示

## 備考
- Container/Presentational パターンは不要（単一コンポーネント内で完結）
- フォーム送信は React Hook Form の `handleSubmit` を使用
- ダイアログは Escape キーで閉じられる
- 背景クリックでダイアログを閉じる動作は shadcn/ui のデフォルト設定に従う
- プレイヤー人数変更時、既存のプレイヤーリストは維持される
